<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Notes </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.68.3" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="https://liuchang0812.github.io/dist/css/app.955516233bcafa4d2a1c13cea63c7b50.css" rel="stylesheet">
    

    

    
      
    

    
      <link href="https://liuchang0812.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Notes" />
      <link href="https://liuchang0812.github.io/index.xml" rel="feed" type="application/rss+xml" title="Notes" />
    

    <meta property="og:title" content="Notes" />
<meta property="og:description" content="Hugo is one of the most popular open-source static site generators. With its amazing speed and flexibility, Hugo makes building websites fun again." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://liuchang0812.github.io/" />
<meta property="og:updated_time" content="2020-01-13T15:50:31+08:00" />
<meta itemprop="name" content="Notes">
<meta itemprop="description" content="Hugo is one of the most popular open-source static site generators. With its amazing speed and flexibility, Hugo makes building websites fun again."><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Notes"/>
<meta name="twitter:description" content="Hugo is one of the most popular open-source static site generators. With its amazing speed and flexibility, Hugo makes building websites fun again."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    

  <header>
    <div class="pb3-m pb6-l bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://liuchang0812.github.io" class="f3 fw2 hover-white no-underline white-90 dib">
      Notes
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://liuchang0812.github.io/" title="Home page">
              Home
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://github.com/liuchang0812" title="Works page">
              Works
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://liuchang0812.github.io/tags/" title="Tags page">
              Tags
            </a>
          </li>
          
        </ul>
      
      









    </div>
  </div>
</nav>

      <div class="tc-l pv3 ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">
          Notes
        </h1>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <article class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy mid-gray">
    
  </article>
  
  
  
  
  
  
  
    
    

    <div class="pa3 pa4-ns w-100 w-70-ns center">
      
       
          <h1 class="flex-none">
            Recent Posts
          </h1>
        

      

      <section class="w-100 mw8">
        
        
          <div class="relative w-100 mb4">
            
<article class="bb b--black-10">
  <div class="db pv4 ph3 ph0-l no-underline dark-gray">
    <div class="flex flex-column flex-row-ns">
      
      <div class="blah w-100">
        <h1 class="f3 fw1 athelas mt0 lh-title">
          <a href="https://liuchang0812.github.io/post/recent-works-on-ceph-kstore/" class="color-inherit dim link">
            最近在 Ceph KStore 上的一些工作（2020-01-13）
            </a>
        </h1>
        <div class="f6 f5-l lh-copy nested-copy-line-height nested-links">
          背景 Ceph 目前自带了一些单机存储引擎，包括
 基于文件的FileStore; 基于KV的KStore； 基于RocksDB+裸盘的BlueStore； 基于内存的测试用MemStore； 基于seastar实现的全用户态SeaStore。  这些单机存储引擎都有适用的用户场景和读写模型。对于海量小文件的场景下，KStore 是一个很好的选择，LSM 架构的 KV 引擎天然的将数据聚合为大文件，顺序的存储到磁盘中。但是，KStore 一直以来应用较少，社区在上面维护的资源也较小。
最近，我们希望在 Rocksdb 层面进行优化，让 Rocksdb 对 blob 写入进行优化。从而使得 KStore 不仅可以支持海量小文件，也可以较好的支持大文件。
让 RocksDB 支持 Blob 存储 原生的 RocksDB 其实不适合存储Blob（Value 较大），因为分层模型和日志的存在，数据放大会更明显，KV在执行后台compaction也会更慢。业界提出的解决方案主要就是“Key Value 分开存储”，这样可以独立对 Blob 文件进行优化，减少写放大和compaction影响。具体可以阅读 Wisckey 的论文（阿里云应该在13年的时候就已经在内部KV实现了这类优化，支持其上OSS类BLOB业务)。
目前，PingCAP 公司基于 RocksDB 和 Wisckey 实现了一个 RocksDB 的插件 TitanDB. 上层程序可以简单的通过 Titan::DB 的命名空间来使用。因此，我们将Titan 替换原生的 RocksDB，使得 KStore 可以较好的存储大文件。
理论上，KStore 层面的代码完全不用修改，性能也不会有损耗。相对于 FileStore，没有 Double Write 的过程，性能更好。相对于 BlueStore，实现上更简单更易维护，对小文件更友善，性能类似。具体的性能报告待整理完善。
Read Stripe Cache 导致的内存泄漏  issue地址 PR地址 与社区讨论地址  这个问题在19年5月分的时候就已经提交到社区，中间因为同事转岗以及社区对read-cache是否有意义有分歧，拖到最近才合并到主线。
        </div>
          <a href="https://liuchang0812.github.io/post/recent-works-on-ceph-kstore/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
        
      </div>
    </div>
  </div>
</article>

          </div>
        
          <div class="relative w-100 mb4">
            
<article class="bb b--black-10">
  <div class="db pv4 ph3 ph0-l no-underline dark-gray">
    <div class="flex flex-column flex-row-ns">
      
      <div class="blah w-100">
        <h1 class="f3 fw1 athelas mt0 lh-title">
          <a href="https://liuchang0812.github.io/post/etcd-client-election/" class="color-inherit dim link">
            Etcd SDK 中的选主实现
            </a>
        </h1>
        <div class="f6 f5-l lh-copy nested-copy-line-height nested-links">
          <p>一句话总结就是：每个会话在指定目录下创建一个键值对，谁先创建成功谁就是主。</p>
        </div>
          <a href="https://liuchang0812.github.io/post/etcd-client-election/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
        
      </div>
    </div>
  </div>
</article>

          </div>
        
          <div class="relative w-100 mb4">
            
<article class="bb b--black-10">
  <div class="db pv4 ph3 ph0-l no-underline dark-gray">
    <div class="flex flex-column flex-row-ns">
      
      <div class="blah w-100">
        <h1 class="f3 fw1 athelas mt0 lh-title">
          <a href="https://liuchang0812.github.io/post/raft-paper-notes/" class="color-inherit dim link">
            Raft Paper Notes
            </a>
        </h1>
        <div class="f6 f5-l lh-copy nested-copy-line-height nested-links">
          为什么要发明 RAFT 一致性协议？ 因为 paxos 过于复杂，难以理解。同时，paxos 是面向学术和理论证明，没有在论文中介绍工程上的实现。如果要实现一个工业级的 paxos，要做很多优化拓展，例如 multi-paxos。为了解决这些问题， raft 是一个把可理解性、明确工程实现方法放在首要考虑地位的算法。
RAFT 算法细节 raft 算法主要分为两个部分: 1)Leader Election; 2)Log Replication。
基本概念  term, 每次 leader 变更时就增长1。每个 term 内只会有一个 leader。时间的逻辑划分，用于 leader election。 RPC，不同结点之间通过 RPC 来通信，在 raft 中有两个 RPC: 1)RequestVote;2)AppendEntries。  Leader Election 空的 AppendEntries RPC 被用来作为心跳包，由 Leader 发送给其它 Server，同时维持其的Leader角色（Leader Authority）。当一个 Server 在超过一定时间(election timeout)没有收来自Leader的心跳包，就认为 Leader 不存在，开始新一轮的选举。
选举的策略比较简单，每个 Server 在每个 Term 只给一个人投票，遵循先到先得的策略。为了尽量避免出现 split 投不出大多数的情况，每个 Server 都有一个随机的election timeout配置，来避免多个 Server 在同时发出 RequestVote 请求。
Log Replication committed log: 保证持久化的日志，不会因为机器故障等各类原因丢失该日志。并且该日志最终会被所有可用机器执行。
        </div>
          <a href="https://liuchang0812.github.io/post/raft-paper-notes/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
        
      </div>
    </div>
  </div>
</article>

          </div>
        
      </section>

      
      <section class="w-100">
        <h1 class="f3">More</h1>
        
        
          <h2 class="f5 fw4 mb4 dib mr3">
            <a href="https://liuchang0812.github.io/post/install-seastar/" class="link black dim">
              Build and Link with SeaStar library
            </a>
          </h2>
        

        
        
          <a href="https://liuchang0812.github.io/post/" class="link db f6 pa2 br3 bg-mid-gray white dim w4 tc">All Posts</a>
        
        </section>
      

      </div>
  

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://liuchang0812.github.io" >
    &copy; 2020 Notes
  </a>
    <div>








</div>
  </div>
</footer>

    

  <script src="https://liuchang0812.github.io/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
